jQuery(function(a){a.extend({serializeJSON:function(e){var d=typeof(e);if(d!="object"||e===null){if(d=="string"){e='"'+e+'"'}return String(e)}else{var c=[],b=(e&&e.constructor==Array);a.each(e,function(g,f){d=typeof(f);if(d=="string"){f='"'+f+'"'}else{if(d=="object"&f!==null){f=a.serializeJSON(f)}}c.push((b?"":'"'+g+'":')+String(f))});return(b?"[":"{")+String(c)+(b?"]":"}")}}});a.extend({GetBrowserName:function(){a.browser.chrome=/chrome/.test(navigator.userAgent.toLowerCase());if(a.browser.msie){return"ie"}if(a.browser.chrome){a.browser.safari=false;return"chrome"}if(a.browser.safari){return"safari"}if(a.browser.mozilla){if(navigator.userAgent.toLowerCase().indexOf("firefox")!=-1){return"mozilla"}}if(a.browser.opera){return"opera"}}})});var Benji=function(a){this.commands=[];this.id=this.genID();this.host="ws://"+a};Benji.prototype.genID=function(){var b=(new Date()).getTime();var a=Math.floor(Math.random()*1000000);return b+a};Benji.prototype.ready=function(b){if($.GetBrowserName()=="mozilla"){this.connection=new MozWebSocket(this.host)}else{this.connection=new WebSocket(this.host)}var a=this;this.connection.onerror=function(c){console.log("WS Error:"+c)};this.connection.onmessage=function(c){a.process(c)};this.connection.onopen=b};Benji.prototype.on=function(a,b){this.commands.push([a,b])};Benji.prototype.process=function(b){for(var a in this.commands){var c=this.commands[a][0];var d=this.commands[a][1];json=$.parseJSON(b.data);if(json.command==c){d(json.data)}}};Benji.prototype.send=function(a){a.id=this.id;this.connection&&this.connection.send($.serializeJSON(a))};var BenjiClient=function(b,a){this.host="ws://"+b;this.ready_callback=a;this.imhere();this.imleaving()};BenjiClient.prototype=new Benji(this.host);BenjiClient.prototype.imhere=function(){var a=this;this.ready(function(){a.send({command:"set_browser",browser:$.GetBrowserName(),time:(new Date()).getTime()});a.ready_callback()})};BenjiClient.prototype.imleaving=function(){var a=this;window.onbeforeunload=function(){a.send({command:"byebye"})}};BenjiClient.prototype.im=function(b,a){this.send({command:b,data:a,time:(new Date()).getTime()})};