<html>
<head>
  <title>WebSocket Demo</title>

  <link rel="stylesheet" href="http://twitter.github.com/bootstrap/1.4.0/bootstrap.min.css">

  <script type="text/javascript" src='https://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js'></script>

  <script type="text/javascript" src='client.js'></script>

  <script type="text/javascript" src='js/highcharts.js'></script>
  <script type="text/javascript">

    $(document).ready(function(){
      live = new LiveStat();

      live.OnCommand('visitors',function(data){
        $('#visitors').text(data.visitors+' visitors currently on site.');

        var series = chart.series[0],
        shift = series.data.length > 15; // shift if the series is longer than 20
    
        // add the point,time*1000 for milliseconds
        chart.series[0].addPoint([data.time*1000,data.visitors], true, shift);
      });

      live.OnCommand('browser',function(data){
        
      });


      chart = new Highcharts.Chart({
        chart: {
          renderTo: 'visitor_chart',
          defaultSeriesType: 'spline',
        },
        title: {
          text: 'Live On Site Users'
        },
        xAxis: {
          type: 'datetime',
        },
        yAxis: {
          minPadding: 0.2,
          maxPadding: 0.2,
          title: {
            text: 'Visitors',
            margin: 20
          }
        },
        series: [{
          name: 'Visitors on Site',
          data: []
        }]
      });   
      chart.yAxis[0].setExtremes(1,30);

      live.run(function(){
  
        live.Send({
          command:'browser',
          browser:navigator.appCodeName,
          time:(new Date()).getTime()
        });

        live.Send({command:'get_visitors'});

      });  

    });

 
  </script>

  <style>
    body{margin-top:200px;}
  </style>
</head>
<body>
  <div class='container'>
    <div class='row'>
      <div class='span10 offset4'>

        <ul class="pills" id='nav'>
          <li class="active"><a href="#">Home</a></li>
          <li><a href="#visitors">Visitors</a></li>
          <li><a href="#browsers">Browsers</a></li>
          <li><a href="#countries">Countries</a></li>
          <li><a href="#referrers">Referrers</a></li>
        </ul>

        <h2 id='visitors'></h2>

        <br/>
        <div id='visitor_chart'>

        </div>
      </div>
    </div>
  </div>
</body>
</html>